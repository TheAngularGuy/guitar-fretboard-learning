<ion-header>
  <ion-toolbar color="primary">
    <ion-buttons slot="start">
      <ion-back-button text="" defaultHref="home"></ion-back-button>
    </ion-buttons>
    <ion-title>Locate</ion-title>
    <ion-buttons slot="end" *ngIf="play">
      <!-- <ion-button (click)="togglePlay()">
        <ion-icon slot="icon-only" name="pause"></ion-icon>
      </ion-button> -->
      <ion-button (click)="toggleShowAll()">
        peek
        <ion-icon slot="end" name="eye"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-buttons slot="end" *ngIf="!play">
      <ion-button (click)="toggleShowSettings()">
        options
        <ion-icon slot="end" name="settings"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content #content>
  <ion-card *ngIf="!play">
    <ion-card-header>
      <ion-card-title>Locate the note on the fretboard!</ion-card-title>
    </ion-card-header>

    <ion-card-content>
      <p>In this game you have to locate the note on the fretboard and click on it.</p>

      <hr />

      <form
        class="settings"
        *ngIf="showSettings"
        [formGroup]="locateForm"
        @slideAnimation
      >
        <ion-item>
          <ion-label>Notes</ion-label>
          <ion-select multiple="true" formControlName="selectedNotes">
            <ion-select-option *ngFor="let note of chromaticScale" [value]="note">
              {{note}}
            </ion-select-option>
          </ion-select>
        </ion-item>
        <ion-item>
          <ion-label>From fret number</ion-label>
          <ion-input formControlName="fretStart" type="number"></ion-input>
        </ion-item>
        <ion-item>
          <ion-label>To fret number</ion-label>
          <ion-input formControlName="fretEnd" type="number"></ion-input>
        </ion-item>
      </form>

      <p class="result" *ngIf="!showSettings">
        <ng-container *ngIf="!scoreHistoric || !scoreHistoric.length">
          Press the button to start playing
        </ng-container>
        <ng-container *ngIf="scoreHistoric && scoreHistoric.length">
          Your score is <b>{{ score.good }}</b> out of {{ scoreHistoric?.length }}. And
          your average time is: <b>{{ getAverageTime() | number }}</b> seconds.
        </ng-container>
      </p>

      <br />

      <div class="start">
        <ion-button
          color="success"
          shape="round"
          (click)="togglePlay()"
          [disabled]="noteToFind"
        >
          <ion-icon name="play" *ngIf="!noteToFind"></ion-icon>
          <ion-icon name="refresh" *ngIf="noteToFind"></ion-icon>
          &nbsp; GO
        </ion-button>
      </div>
    </ion-card-content>
  </ion-card>

  <ion-card *ngIf="play" class="hide-on-mobile">
    <ion-card-header>
      <ion-card-title>Locate the note on the fretboard!</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <p>In this game you have to locate the note on the fretboard and click on it.</p>
      <br />

      <ng-container *ngTemplateOutlet="playingControls"></ng-container>
    </ion-card-content>
  </ion-card>
  <br />

  <app-fretboard
    [ngClass]="{'hide-on-mobile': !play}"
    [notes]="fretboardNotes"
    [leftHanded]="preferences?.leftHandedMode"
    [showAll]="showAll"
    [selectedFrets]="[locateForm?.value.fretStart, locateForm?.value.fretEnd]"
    [selectedNotes]="noteToFind ? [noteToFind.note.noteName] : null"
    (noteClick)="onNoteClicked($event)"
  ></app-fretboard>
  <br />
</ion-content>

<ion-footer color="light" *ngIf="play" class="hide-on-desktop">
  <ng-container *ngTemplateOutlet="playingControls"></ng-container>
  <div *ngIf="utils.isIOSPWA()" style="height: 2ch;"></div>
</ion-footer>

<ng-template #playingControls>
  <div class="playing">
    <div class="score">
      <p class="good">
        <ion-icon name="thumbs-up" color="success"></ion-icon> &nbsp;
        <b [@popAnimation]="score.good">{{score.good}}</b> &nbsp; / {{maxRange}}
      </p>
      <p class="bad">
        <ion-icon name="thumbs-down" color="danger"></ion-icon> &nbsp;
        <b [@popAnimation]="score.bad">{{score.bad}} </b> &nbsp; / {{maxRange}}
      </p>
      <ion-button
        fill="outline"
        color="danger"
        size="small"
        style="width: 9ch"
        (click)="togglePlay()"
      >
        Stop
      </ion-button>
    </div>
    <div class="note" [@popAnimation]="noteToFind?.note?.noteName">
      {{noteToFind?.note?.noteName}}
    </div>
  </div>
</ng-template>
